"""
Django settings for application project.

Generated by 'django-admin startproject' using Django 3.2.3.

For more information on this file, see
https://docs.djangoproject.com/en/4.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/4.1/ref/settings/

===============================================================================
Django Settings ä½œç”¨è¯´æ˜ï¼š
===============================================================================

è¿™æ˜¯ä¸€ä¸ªåŸºäº Django çš„ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿï¼ˆdjango-vue3-adminï¼‰çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œ
è´Ÿè´£æ•´ä¸ªåº”ç”¨çš„å„é¡¹è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼š

ğŸ”§ æ ¸å¿ƒåŠŸèƒ½ï¼š
  â€¢ æ•°æ®åº“é…ç½®ï¼ˆSQLite/MySQL/PostgreSQLåŠ¨æ€åˆ‡æ¢ï¼‰
  â€¢ ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†ï¼ˆJWT + è‡ªå®šä¹‰åç«¯ï¼‰
  â€¢ REST API é…ç½®ï¼ˆDRF + Swaggeræ–‡æ¡£ï¼‰
  â€¢ å®æ—¶é€šä¿¡æ”¯æŒï¼ˆChannels + WebSocketï¼‰
  â€¢ æ’ä»¶åŒ–æ¶æ„ï¼ˆåŠ¨æ€æ¨¡å—åŠ è½½ï¼‰

ğŸ›¡ï¸ å®‰å…¨é…ç½®ï¼š
  â€¢ CORSè·¨åŸŸå¤„ç†
  â€¢ CSRFä¿æŠ¤
  â€¢ å¯†ç å¼ºåº¦éªŒè¯
  â€¢ éªŒè¯ç ç³»ç»Ÿ

ğŸ“Š ç›‘æ§è¿ç»´ï¼š
  â€¢ åˆ†çº§æ—¥å¿—ç³»ç»Ÿï¼ˆæ–‡ä»¶è½®è½¬ï¼‰
  â€¢ APIè¯·æ±‚æ—¥å¿—
  â€¢ å¥åº·æ£€æŸ¥ä¸­é—´ä»¶
  â€¢ æ€§èƒ½ä¼˜åŒ–é…ç½®

ğŸ”Œ æ‰©å±•ç‰¹æ€§ï¼š
  â€¢ å¼‚æ­¥ä»»åŠ¡æ”¯æŒï¼ˆCeleryï¼‰
  â€¢ é™æ€æ–‡ä»¶å‹ç¼©
  â€¢ å¤šç§Ÿæˆ·æ¶æ„å‡†å¤‡
  â€¢ ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

é…ç½®æ–‡ä»¶é€šè¿‡ç¯å¢ƒå˜é‡å®ç°å¼€å‘/ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ï¼Œæ”¯æŒæ’ä»¶çƒ­æ’æ‹”å’Œæ¨¡å—åŒ–æ‰©å±•ã€‚
===============================================================================
"""

# ================================================= #
# ************** æ•°æ®åº“é©±åŠ¨é…ç½® ************** #
# ================================================= #
# ä½¿ç”¨ pymysql æ›¿ä»£ mysqlclient
# åŸå› ï¼šmysqlclient åœ¨æŸäº›ç³»ç»Ÿä¸Šå®‰è£…å›°éš¾ï¼Œpymysql æ˜¯çº¯ Python å®ç°ï¼Œæ›´æ˜“å®‰è£…
import pymysql
pymysql.install_as_MySQLdb()

# ================================================= #
# ************** åŸºç¡€å¯¼å…¥å’Œè·¯å¾„é…ç½® ************** #
# ================================================= #
import os
import sys
from pathlib import Path
from datetime import timedelta

# é¡¹ç›®æ ¹ç›®å½•è·¯å¾„
# ä½¿ç”¨ Path(__file__).resolve().parent.parent è·å– settings.py æ‰€åœ¨ç›®å½•çš„ä¸Šçº§ç›®å½•
BASE_DIR = Path(__file__).resolve().parent.parent

# ================================================= #
# ******************** åŠ¨æ€é…ç½® ******************** #
# ================================================= #
# ä»ç¯å¢ƒé…ç½®æ–‡ä»¶å¯¼å…¥æ‰€æœ‰è®¾ç½®
# è¿™ç§æ–¹å¼å…è®¸é€šè¿‡ç¯å¢ƒå˜é‡åŠ¨æ€é…ç½®ï¼Œè€Œä¸ä¿®æ”¹ä»£ç 
from conf.env import *

# ================================================= #
# ************** Django æ ¸å¿ƒå®‰å…¨é…ç½® ************** #
# ================================================= #
# SECURITY WARNING: keep the secret key used in production secret!
# å®‰å…¨å¯†é’¥ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ä¸ºéšæœºç”Ÿæˆçš„å¤æ‚å­—ç¬¦ä¸²
SECRET_KEY = "django-insecure--z8%exyzt7e_%i@1+#1mm=%lb5=^fx_57=1@a+_y7bg5-w%)sm"

# åˆå§‹åŒ–æ’ä»¶è·¯å¾„åˆ° Python è·¯å¾„ä¸­
# å®ç°æ’ä»¶åŒ–æ¶æ„çš„æ ¸å¿ƒï¼šè¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ’ä»¶æ¨¡å—
PLUGINS_PATH = os.path.join(BASE_DIR, "plugins")
sys.path.insert(0, os.path.join(PLUGINS_PATH))

# åŠ¨æ€æ‰«æå¹¶åŠ è½½æ‰€æœ‰æ’ä»¶ç›®å½•åˆ° Python è·¯å¾„
# è¿‡æ»¤æ¡ä»¶ï¼šå¿…é¡»æ˜¯ç›®å½•ä¸”ä¸ä»¥ __ å¼€å¤´ï¼ˆæ’é™¤ __pycache__ ç­‰ï¼‰
[
    sys.path.insert(0, os.path.join(PLUGINS_PATH, ele))
    for ele in os.listdir(PLUGINS_PATH)
    if os.path.isdir(os.path.join(PLUGINS_PATH, ele)) and not ele.startswith("__")
]

# ================================================= #
# ************** å¼€å‘ç¯å¢ƒåŸºæœ¬é…ç½® ************** #
# ================================================= #
# SECURITY WARNING: don't run with debug turned on in production!
# DEBUG æ¨¡å¼ï¼šå¼€å‘æ—¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ä¸º False
DEBUG = locals().get("DEBUG", True)

# å…è®¸è®¿é—®çš„ä¸»æœºåˆ—è¡¨
# å¼€å‘ç¯å¢ƒå…è®¸æ‰€æœ‰ä¸»æœºï¼Œç”Ÿäº§ç¯å¢ƒåº”è¯¥è®¾ç½®å…·ä½“åŸŸåå¦‚ ['yourdomain.com']
ALLOWED_HOSTS = locals().get("ALLOWED_HOSTS", ["*"])

# ================================================= #
# ************** æƒé™ç³»ç»Ÿé…ç½® ************** #
# ================================================= #
# åˆ—æƒé™éœ€è¦æ’é™¤çš„åº”ç”¨åˆ—è¡¨
# è¿™äº›åº”ç”¨çš„æ•°æ®è¡¨ä¸å‚ä¸å­—æ®µçº§æƒé™æ§åˆ¶
COLUMN_EXCLUDE_APPS = ['channels', 'captcha'] + locals().get("COLUMN_EXCLUDE_APPS", [])

# ================================================= #
# ************** å·²å®‰è£…åº”ç”¨åˆ—è¡¨ ************** #
# ================================================= #
INSTALLED_APPS = [
    # Django æ ¸å¿ƒåº”ç”¨
    "django.contrib.auth",          # ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
    "django.contrib.contenttypes",  # å†…å®¹ç±»å‹æ¡†æ¶
    "django.contrib.sessions",      # ä¼šè¯ç®¡ç†
    "django.contrib.messages",      # æ¶ˆæ¯æ¡†æ¶
    "django.contrib.staticfiles",   # é™æ€æ–‡ä»¶ç®¡ç†

    # é¡¹ç›®ä¸“ç”¨åº”ç”¨
    "django_comment_migrate",       # æ•°æ®åº“æ³¨é‡Šè¿ç§»
    "rest_framework",               # REST API æ¡†æ¶
    "django_filters",               # é«˜çº§è¿‡æ»¤å™¨
    "corsheaders",                  # è·¨åŸŸè¯·æ±‚å¤„ç†
    "drf_yasg",                     # Swagger API æ–‡æ¡£
    "captcha",                      # éªŒè¯ç 
    "channels",                     # WebSocket æ”¯æŒ
    "dvadmin.system",               # ç³»ç»Ÿç®¡ç†æ¨¡å—
    "dvadmin.book",                 # å›¾ä¹¦ç®¡ç†æ¨¡å—
]

# ================================================= #
# ************** ä¸­é—´ä»¶é…ç½® ************** #
# ================================================= #
MIDDLEWARE = [
    # è‡ªå®šä¹‰å¥åº·æ£€æŸ¥ä¸­é—´ä»¶ï¼ˆç”¨äºç›‘æ§æœåŠ¡çŠ¶æ€ï¼‰
    "dvadmin.utils.middleware.HealthCheckMiddleware",

    # Django å®‰å…¨ä¸­é—´ä»¶ï¼ˆæä¾›å®‰å…¨å¤´ã€å®‰å…¨æ£€æŸ¥ç­‰ï¼‰
    "django.middleware.security.SecurityMiddleware",

    # ç™½å™ªå£°ä¸­é—´ä»¶ï¼ˆç”Ÿäº§ç¯å¢ƒé™æ€æ–‡ä»¶æœåŠ¡ï¼‰
    "whitenoise.middleware.WhiteNoiseMiddleware",

    # ä¼šè¯ä¸­é—´ä»¶
    "django.contrib.sessions.middleware.SessionMiddleware",

    # è·¨åŸŸä¸­é—´ä»¶ï¼ˆå¤„ç† CORS é¢„æ£€è¯·æ±‚ï¼‰
    "corsheaders.middleware.CorsMiddleware",

    # é€šç”¨ä¸­é—´ä»¶ï¼ˆURL é‡å†™ã€è¯·æ±‚å¤„ç†ç­‰ï¼‰
    "django.middleware.common.CommonMiddleware",

    # CSRF ä¿æŠ¤ä¸­é—´ä»¶
    "django.middleware.csrf.CsrfViewMiddleware",

    # ç”¨æˆ·è®¤è¯ä¸­é—´ä»¶
    "django.contrib.auth.middleware.AuthenticationMiddleware",

    # æ¶ˆæ¯ä¸­é—´ä»¶
    "django.contrib.messages.middleware.MessageMiddleware",

    # ç‚¹å‡»åŠ«æŒä¿æŠ¤ä¸­é—´ä»¶
    "django.middleware.clickjacking.XFrameOptionsMiddleware",

    # è‡ªå®šä¹‰ API æ—¥å¿—ä¸­é—´ä»¶ï¼ˆè®°å½• API è¯·æ±‚ï¼‰
    "dvadmin.utils.middleware.ApiLoggingMiddleware",
]

# ================================================= #
# ************** URL å’Œæ¨¡æ¿é…ç½® ************** #
# ================================================= #
# ä¸» URL é…ç½®æ–‡ä»¶
ROOT_URLCONF = "application.urls"

# æ¨¡æ¿é…ç½®
TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        # æ¨¡æ¿æœç´¢ç›®å½•
        "DIRS": [os.path.join(BASE_DIR, "templates")],
        # å…è®¸åœ¨åº”ç”¨ç›®å½•ä¸­æœç´¢æ¨¡æ¿
        "APP_DIRS": True,
        "OPTIONS": {
            # æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨ï¼ˆä¸ºæ¨¡æ¿æä¾›é¢å¤–å˜é‡ï¼‰
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

# WSGI åº”ç”¨é…ç½®ï¼ˆä¼ ç»ŸåŒæ­¥ Web æœåŠ¡å™¨æ¥å£ï¼‰
WSGI_APPLICATION = "application.wsgi.application"

# ================================================= #
# ************** æ•°æ®åº“é…ç½® ************** #
# ================================================= #
# æ ¹æ®æ•°æ®åº“å¼•æ“ç±»å‹åŠ¨æ€é…ç½®æ•°æ®åº“è¿æ¥
# æ”¯æŒ SQLiteï¼ˆå¼€å‘ç¯å¢ƒï¼‰å’Œ MySQL/PostgreSQLï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
if DATABASE_ENGINE == "django.db.backends.sqlite3":
    # SQLite é…ç½®ï¼ˆè½»é‡çº§ï¼Œæ–‡ä»¶æ•°æ®åº“ï¼‰
    DATABASES = {
        "default": {
            "ENGINE": DATABASE_ENGINE,
            "NAME": DATABASE_NAME,  # æ•°æ®åº“æ–‡ä»¶è·¯å¾„
        }
    }
else:
    # å…³ç³»å‹æ•°æ®åº“é…ç½®ï¼ˆMySQL/PostgreSQLï¼‰
    DATABASES = {
        "default": {
            "ENGINE": DATABASE_ENGINE,
            "NAME": DATABASE_NAME,      # æ•°æ®åº“å
            "USER": DATABASE_USER,      # ç”¨æˆ·å
            "PASSWORD": DATABASE_PASSWORD,  # å¯†ç 
            "HOST": DATABASE_HOST,      # ä¸»æœºåœ°å€
            "PORT": DATABASE_PORT,      # ç«¯å£å·
        }
    }

# ================================================= #
# ************** ç”¨æˆ·æ¨¡å‹é…ç½® ************** #
# ================================================= #
# è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ï¼ˆæ›¿ä»£ Django é»˜è®¤çš„ User æ¨¡å‹ï¼‰
AUTH_USER_MODEL = "system.Users"
# æŒ‡å®šç”¨æˆ·åå­—æ®µï¼ˆé€šå¸¸æ˜¯ 'username' æˆ– 'email'ï¼‰
USERNAME_FIELD = "username"

# ================================================= #
# ************** å¯†ç éªŒè¯å™¨é…ç½® ************** #
# ================================================= #
# Django å†…ç½®å¯†ç å¼ºåº¦éªŒè¯å™¨
AUTH_PASSWORD_VALIDATORS = [
    {
        # é˜²æ­¢å¯†ç ä¸ç”¨æˆ·å±æ€§ç›¸ä¼¼
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        # å¯†ç æœ€å°é•¿åº¦éªŒè¯
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        # é˜²æ­¢å¸¸è§å¯†ç 
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        # é˜²æ­¢çº¯æ•°å­—å¯†ç 
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]

# ================================================= #
# ************** å›½é™…åŒ–é…ç½® ************** #
# ================================================= #
# è¯­è¨€è®¾ç½®ï¼šç®€ä½“ä¸­æ–‡
LANGUAGE_CODE = "zh-hans"

# æ—¶åŒºè®¾ç½®ï¼šä¸œå…«åŒºï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
TIME_ZONE = "Asia/Shanghai"

# å¯ç”¨å›½é™…åŒ–æ”¯æŒ
USE_I18N = True

# å¯ç”¨æœ¬åœ°åŒ–æ”¯æŒ
USE_L10N = True

# ç¦ç”¨æ—¶åŒºæ„ŸçŸ¥ï¼ˆä½¿ç”¨æœ¬åœ°æ—¶é—´è€Œä¸æ˜¯ UTCï¼‰
USE_TZ = False

# ================================================= #
# ************** é™æ€æ–‡ä»¶å’Œåª’ä½“æ–‡ä»¶é…ç½® ************** #
# ================================================= #
# é™æ€æ–‡ä»¶ URL å‰ç¼€
STATIC_URL = "/static/"

# é™æ€æ–‡ä»¶æœç´¢ç›®å½•
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, "static"),
]

# åª’ä½“æ–‡ä»¶å­˜å‚¨ç›®å½•
MEDIA_ROOT = "media"

# åª’ä½“æ–‡ä»¶ URL å‰ç¼€
MEDIA_URL = "/media/"

# é™æ€æ–‡ä»¶æŸ¥æ‰¾å™¨é…ç½®
STATICFILES_FINDERS = (
    "django.contrib.staticfiles.finders.FileSystemFinder",
    "django.contrib.staticfiles.finders.AppDirectoriesFinder"
)

# ç”Ÿäº§ç¯å¢ƒé™æ€æ–‡ä»¶æ”¶é›†é…ç½®ï¼ˆæ³¨é‡Šæ‰çš„æ˜¯ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰
# STATIC_ROOT = os.path.join(BASE_DIR, 'static')

# ================================================= #
# ******************* è·¨åŸŸé…ç½® ******************* #
# ================================================= #
# å…è®¸æ‰€æœ‰åŸŸåè·¨åŸŸè®¿é—®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
CORS_ORIGIN_ALLOW_ALL = True

# å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦è®¤è¯ä¿¡æ¯ï¼ˆcookiesã€authorization headersï¼‰
CORS_ALLOW_CREDENTIALS = True

# ================================================= #
# ******************* Channels é…ç½® ******************* #
# ================================================= #
# ASGI åº”ç”¨é…ç½®ï¼ˆæ”¯æŒå¼‚æ­¥å’Œ WebSocketï¼‰
ASGI_APPLICATION = 'application.asgi.application'

# Channels åç«¯é…ç½®ï¼ˆå†…å­˜å­˜å‚¨ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒï¼‰
CHANNEL_LAYERS = {
    "default": {
        "BACKEND": "channels.layers.InMemoryChannelLayer"
    }
}

# Redis åç«¯é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼Œæ³¨é‡Šæ‰ï¼‰
# CHANNEL_LAYERS = {
#     'default': {
#         'BACKEND': 'channels_redis.core.RedisChannelLayer',
#         'CONFIG': {
#             "hosts": [('127.0.0.1', 6379)],
#         },
#     },
# }

# ================================================= #
# ********************* æ—¥å¿—é…ç½® ******************* #
# ================================================= #
# æ—¥å¿—æ–‡ä»¶è·¯å¾„é…ç½®
SERVER_LOGS_FILE = os.path.join(BASE_DIR, "logs", "server.log")
ERROR_LOGS_FILE = os.path.join(BASE_DIR, "logs", "error.log")
LOGS_FILE = os.path.join(BASE_DIR, "logs")

# è‡ªåŠ¨åˆ›å»ºæ—¥å¿—ç›®å½•
if not os.path.exists(os.path.join(BASE_DIR, "logs")):
    os.makedirs(os.path.join(BASE_DIR, "logs"))

# æ—¥å¿—æ ¼å¼å®šä¹‰
# æ ¼å¼: [æ—¶é—´][æ¨¡å—.å‡½æ•°():è¡Œå·] [çº§åˆ«] æ¶ˆæ¯å†…å®¹
STANDARD_LOG_FORMAT = (
    "[%(asctime)s][%(name)s.%(funcName)s():%(lineno)d] [%(levelname)s] %(message)s"
)
CONSOLE_LOG_FORMAT = (
    "[%(asctime)s][%(name)s.%(funcName)s():%(lineno)d] [%(levelname)s] %(message)s"
)

# Django æ—¥å¿—é…ç½®
LOGGING = {
    "version": 1,
    "disable_existing_loggers": False,
    "formatters": {
        # æ ‡å‡†æ ¼å¼å™¨
        "standard": {"format": STANDARD_LOG_FORMAT},
        # æ§åˆ¶å°æ ¼å¼å™¨ï¼ˆå¸¦æ—¶é—´æ ¼å¼ï¼‰
        "console": {
            "format": CONSOLE_LOG_FORMAT,
            "datefmt": "%Y-%m-%d %H:%M:%S",
        },
        # æ–‡ä»¶æ ¼å¼å™¨
        "file": {
            "format": CONSOLE_LOG_FORMAT,
            "datefmt": "%Y-%m-%d %H:%M:%S",
        },
    },
    "handlers": {
        # æ–‡ä»¶å¤„ç†å™¨ï¼ˆINFO çº§åˆ«åŠä»¥ä¸Šï¼‰
        "file": {
            "level": "INFO",
            "class": "logging.handlers.RotatingFileHandler",
            "filename": SERVER_LOGS_FILE,
            "maxBytes": 1024 * 1024 * 100,  # 100MB
            "backupCount": 5,  # ä¿ç•™5ä¸ªå¤‡ä»½æ–‡ä»¶
            "formatter": "standard",
            "encoding": "utf-8",
        },
        # é”™è¯¯æ–‡ä»¶å¤„ç†å™¨ï¼ˆERROR çº§åˆ«åŠä»¥ä¸Šï¼‰
        "error": {
            "level": "ERROR",
            "class": "logging.handlers.RotatingFileHandler",
            "filename": ERROR_LOGS_FILE,
            "maxBytes": 1024 * 1024 * 100,  # 100MB
            "backupCount": 3,  # ä¿ç•™3ä¸ªå¤‡ä»½æ–‡ä»¶
            "formatter": "standard",
            "encoding": "utf-8",
        },
        # æ§åˆ¶å°å¤„ç†å™¨
        "console": {
            "level": "INFO",
            "class": "logging.StreamHandler",
            "formatter": "console",
        },
    },
    "loggers": {
        # æ ¹æ—¥å¿—å™¨
        "": {
            "handlers": ["console", "error", "file"],
            "level": "INFO",
        },
        # Django æ¡†æ¶æ—¥å¿—å™¨
        "django": {
            "handlers": ["console", "error", "file"],
            "level": "INFO",
            "propagate": False,
        },
        # æ•°æ®åº“åç«¯æ—¥å¿—å™¨
        'django.db.backends': {
            'handlers': ["console", "error", "file"],
            'propagate': False,
            'level': "INFO"
        },
        # Uvicorn æœåŠ¡å™¨æ—¥å¿—å™¨
        "uvicorn.error": {
            "level": "INFO",
            "handlers": ["console", "error", "file"],
        },
        "uvicorn.access": {
            "handlers": ["console", "error", "file"],
            "level": "INFO"
        },
    },
}

# ================================================= #
# *************** REST Framework é…ç½® *************** #
# ================================================= #
REST_FRAMEWORK = {
    # é»˜è®¤è§£æå™¨ç±»ï¼ˆæ”¯æŒ JSON å’Œæ–‡ä»¶ä¸Šä¼ ï¼‰
    'DEFAULT_PARSER_CLASSES': (
        'rest_framework.parsers.JSONParser',
        'rest_framework.parsers.MultiPartParser',
    ),

    # æ—¥æœŸæ—¶é—´æ ¼å¼
    "DATETIME_FORMAT": "%Y-%m-%d %H:%M:%S",
    "DATE_FORMAT": "%Y-%m-%d",

    # é»˜è®¤è¿‡æ»¤å™¨åç«¯
    "DEFAULT_FILTER_BACKENDS": (
        "dvadmin.utils.filters.CustomDjangoFilterBackend",  # è‡ªå®šä¹‰è¿‡æ»¤å™¨
        "rest_framework.filters.SearchFilter",              # æœç´¢è¿‡æ»¤å™¨
        "rest_framework.filters.OrderingFilter",            # æ’åºè¿‡æ»¤å™¨
    ),

    # é»˜è®¤åˆ†é¡µç±»
    "DEFAULT_PAGINATION_CLASS": "dvadmin.utils.pagination.CustomPagination",

    # é»˜è®¤è®¤è¯ç±»
    "DEFAULT_AUTHENTICATION_CLASSES": (
        "rest_framework_simplejwt.authentication.JWTAuthentication",  # JWT è®¤è¯
        "rest_framework.authentication.SessionAuthentication",         # ä¼šè¯è®¤è¯
    ),

    # é»˜è®¤æƒé™ç±»ï¼ˆè¦æ±‚ç”¨æˆ·å¿…é¡»ç™»å½•ï¼‰
    "DEFAULT_PERMISSION_CLASSES": [
        "rest_framework.permissions.IsAuthenticated",
    ],

    # è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨
    "EXCEPTION_HANDLER": "dvadmin.utils.exception.CustomExceptionHandler",
}

# ================================================= #
# ******************** è®¤è¯åç«¯é…ç½® ******************** #
# ================================================= #
# è‡ªå®šä¹‰è®¤è¯åç«¯ï¼ˆæ”¯æŒå¤šç§ç™»å½•æ–¹å¼ï¼‰
AUTHENTICATION_BACKENDS = ["dvadmin.utils.backends.CustomBackend"]

# ================================================= #
# ****************** JWT é…ç½® ***************** #
# ================================================= #
SIMPLE_JWT = {
    # Access Token æœ‰æ•ˆæœŸï¼ˆ24å°æ—¶ï¼‰
    "ACCESS_TOKEN_LIFETIME": timedelta(minutes=1440),

    # Refresh Token æœ‰æ•ˆæœŸï¼ˆ1å¤©ï¼‰
    "REFRESH_TOKEN_LIFETIME": timedelta(days=1),

    # è®¤è¯å¤´ç±»å‹å‰ç¼€
    "AUTH_HEADER_TYPES": ("JWT",),

    # è‡ªåŠ¨è½®æ¢ Refresh Token
    "ROTATE_REFRESH_TOKENS": True,
}

# ================================================= #
# ****************** Swagger é…ç½® ****************** #
# ================================================= #
SWAGGER_SETTINGS = {
    # å®‰å…¨å®šä¹‰
    "SECURITY_DEFINITIONS": {"basic": {"type": "basic"}},

    # ç™»å½•/ç™»å‡º URL
    "LOGIN_URL": "apiLogin/",
    "LOGOUT_URL": "rest_framework:logout",

    # æ¥å£æ’åºæ–¹å¼ï¼ˆå­—æ¯é¡ºåºï¼‰
    "APIS_SORTER": "alpha",

    # å¯ç”¨ JSON ç¼–è¾‘å™¨
    "JSON_EDITOR": True,

    # æ“ä½œæ’åºæ–¹å¼
    "OPERATIONS_SORTER": "alpha",

    # éªŒè¯å™¨ URL
    "VALIDATOR_URL": None,

    # API åˆ†ç»„å±‚çº§ï¼ˆ2å±‚åˆ†ç»„ï¼‰
    "AUTO_SCHEMA_TYPE": 2,

    # è‡ªå®šä¹‰ Schema ç±»
    "DEFAULT_AUTO_SCHEMA_CLASS": "dvadmin.utils.swagger.CustomSwaggerAutoSchema",
}

# ================================================= #
# **************** éªŒè¯ç é…ç½®  ******************* #
# ================================================= #
# éªŒè¯ç å›¾ç‰‡å°ºå¯¸
CAPTCHA_IMAGE_SIZE = (160, 46)

# éªŒè¯ç å­—ç¬¦é•¿åº¦
CAPTCHA_LENGTH = 4

# éªŒè¯ç è¶…æ—¶æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
CAPTCHA_TIMEOUT = 1

# éªŒè¯ç è¾“å‡ºæ ¼å¼
CAPTCHA_OUTPUT_FORMAT = "%(image)s %(text_field)s %(hidden_field)s "

# å­—ä½“å¤§å°
CAPTCHA_FONT_SIZE = 36

# å‰æ™¯è‰²ï¼ˆæ–‡å­—é¢œè‰²ï¼‰
CAPTCHA_FOREGROUND_COLOR = "#64DAAA"

# èƒŒæ™¯è‰²
CAPTCHA_BACKGROUND_COLOR = "#F5F7F4"

# å¹²æ‰°å…ƒç´ ï¼ˆå¼§çº¿å¹²æ‰°ï¼‰
CAPTCHA_NOISE_FUNCTIONS = (
    "captcha.helpers.noise_arcs",
    # "captcha.helpers.noise_dots",  # ç‚¹å¹²æ‰°ï¼ˆå·²æ³¨é‡Šï¼‰
)

# éªŒè¯ç ç±»å‹ï¼šæ•°å­¦è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰
CAPTCHA_CHALLENGE_FUNCT = "captcha.helpers.math_challenge"

# ================================================= #
# ******************** å…¶ä»–é…ç½® ******************** #
# ================================================= #
# é»˜è®¤è‡ªåŠ¨å­—æ®µç±»å‹
DEFAULT_AUTO_FIELD = "django.db.models.AutoField"

# API æ—¥å¿—å¯ç”¨
API_LOG_ENABLE = True

# API æ—¥å¿—è®°å½•çš„æ–¹æ³•
API_LOG_METHODS = ["POST", "UPDATE", "DELETE", "PUT"]

# API æ¨¡å—æ˜ å°„ï¼ˆç”¨äºæ—¥å¿—åˆ†ç±»ï¼‰
API_MODEL_MAP = {
    "/token/": "ç™»å½•æ¨¡å—",
    "/api/login/": "ç™»å½•æ¨¡å—",
    "/api/plugins_market/plugins/": "æ’ä»¶å¸‚åœº",
}

# Celery æ—¶åŒºé…ç½®
DJANGO_CELERY_BEAT_TZ_AWARE = False
CELERY_TIMEZONE = "Asia/Shanghai"

# é™æ€æ–‡ä»¶å­˜å‚¨ï¼ˆå¯ç”¨å‹ç¼©ï¼‰
STATICFILES_STORAGE = "whitenoise.storage.CompressedStaticFilesStorage"

# å…¨å±€å˜é‡
ALL_MODELS_OBJECTS = []  # æ‰€æœ‰åº”ç”¨æ¨¡å‹å¯¹è±¡åˆ—è¡¨

# åˆå§‹åŒ–æ‰§è¡Œåˆ—è¡¨
INITIALIZE_LIST = []      # ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œçš„ä»»åŠ¡
INITIALIZE_RESET_LIST = [] # é‡ç½®æ—¶æ‰§è¡Œçš„ä»»åŠ¡

# æ•°æ®åº“è¡¨å‰ç¼€
TABLE_PREFIX = locals().get('TABLE_PREFIX', "")

# ç³»ç»Ÿé…ç½®å­—å…¸
SYSTEM_CONFIG = {}

# å­—å…¸é…ç½®
DICTIONARY_CONFIG = {}

# ================================================= #
# ******************** æ’ä»¶é…ç½® ******************** #
# ================================================= #
# ç§Ÿæˆ·å…±äº«åº”ç”¨åˆ—è¡¨
TENANT_SHARED_APPS = []

# ç§Ÿæˆ·ç‹¬æœ‰åº”ç”¨åˆ—è¡¨
TENANT_EXCLUSIVE_APPS = []

# æ’ä»¶ URL æ¨¡å¼åˆ—è¡¨
PLUGINS_URL_PATTERNS = []

# å…±äº«åº”ç”¨åˆ—è¡¨
SHARED_APPS = []

# ********** ä¸€é”®å¯¼å…¥æ’ä»¶é…ç½®å¼€å§‹ **********
# è¿™é‡Œå¯ä»¥å¯¼å…¥å„ç§æ’ä»¶çš„é…ç½®
# ä¾‹å¦‚:
# from dvadmin_upgrade_center.settings import *    # å‡çº§ä¸­å¿ƒ
from dvadmin3_celery.settings import *            # Celery å¼‚æ­¥ä»»åŠ¡æ’ä»¶
from dvadmin3_flow.settings import *              # å®¡æ‰¹æµç¨‹æ’ä»¶
# from dvadmin_third.settings import *            # ç¬¬ä¸‰æ–¹ç”¨æˆ·ç®¡ç†
# from dvadmin_ak_sk.settings import *            # ç§˜é’¥ç®¡ç†
# from dvadmin_tenants.settings import *            # ç§Ÿæˆ·ç®¡ç†
# from dvadmin_social_auth.settings import *
# from dvadmin_uniapp.settings import *
# ...
# ********** ä¸€é”®å¯¼å…¥æ’ä»¶é…ç½®ç»“æŸ **********
