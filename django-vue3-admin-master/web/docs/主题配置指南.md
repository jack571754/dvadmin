# DVAdmin 页面主题配置指南

> 最后更新：2026-02-08
> 适用于：DVAdmin v3.2.0+

---

## 目录

1. [快速开始](#快速开始)
2. [方式一：使用现代化设置面板](#方式一使用现代化设置面板)
3. [方式二：集成到现有设置页面](#方式二集成到现有设置页面)
4. [方式三：单独页面配置](#方式三单独页面配置)
5. [方式四：编程式配置](#方式四编程式配置)
6. [配置持久化](#配置持久化)
7. [常见问题](#常见问题)

---

## 快速开始

### 前提条件

确保已完成以下步骤：

1. 引入现代化主题样式（参考 `theme/README.md`）
2. 复制组件文件到项目

```bash
# 复制组件文件
cp -r web/src/components/ThemePresetSelector web/src/components/
cp -r web/src/components/ThemeColorPicker web/src/components/
cp -r web/src/components/ThemeSettings web/src/components/

# 复制工具文件
cp web/src/utils/themePresets.ts web/src/utils/
cp web/src/utils/themePresets.d.ts web/src/utils/
```

---

## 方式一：使用现代化设置面板

### 步骤 1：替换现有设置页面

编辑 `web/src/layout/navBars/breadcrumb/index.vue`，替换为新的现代化设置：

```vue
<template>
  <div class="layout-navbars-breadcrumb-index">
    <!-- 其他导航栏组件 -->

    <!-- 使用现代化设置面板 -->
    <setings-modern ref="setingsRef" />
  </div>
</template>

<script setup lang="ts">
import SetingsModern from './setings-modern.vue';

const setingsRef = ref();
</script>
```

### 步骤 2：添加设置按钮

确保顶栏有设置按钮（通常已存在）：

```vue
<el-tooltip content="布局设置" effect="dark" placement="bottom">
  <i class="icon-skin iconfont setting-icon" @click="openSetingsDrawer"></i>
</el-tooltip>
```

---

## 方式二：集成到现有设置页面

### 在现有设置面板中添加主题预设部分

编辑 `web/src/layout/navBars/breadcrumb/setings.vue`，在 `el-scrollbar` 内最前面添加：

```vue
<template>
  <div class="layout-breadcrumb-seting">
    <el-drawer ...>
      <el-scrollbar class="layout-breadcrumb-seting-bar">

        <!-- 新增：主题预设部分 -->
        <div class="setting-section">
          <div class="section-header">
            <h4 class="section-title">主题预设</h4>
            <p class="section-desc">快速切换整体外观</p>
          </div>
          <div class="preset-grid">
            <div
              v-for="preset in themePresets"
              :key="preset.key"
              class="preset-card"
              :class="{ 'is-active': currentPreset === preset.key }"
              @click="onPresetClick(preset)"
            >
              <div
                class="preset-preview"
                :style="{ background: preset.preview }"
              ></div>
              <div class="preset-name">{{ preset.name }}</div>
            </div>
          </div>
        </div>

        <!-- 原有的全局主题等内容 -->
        <el-divider content-position="left">{{ $t('message.layout.oneTitle') }}</el-divider>
        <!-- ... -->
      </el-scrollbar>
    </el-drawer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { applyThemePreset, type ThemePreset } from '/@/utils/themePresets';

// 当前预设
const currentPreset = ref('serenity');

// 主题预设列表
const themePresets: ThemePreset[] = [
  { key: 'serenity', name: '静谧蓝', preview: '#2563eb' },
  { key: 'forest', name: '森之绿', preview: '#059669' },
  { key: 'twilight', name: '暮光紫', preview: '#7c3aed' },
  { key: 'sunset', name: '日落橙', preview: '#ea580c' },
  { key: 'ocean', name: '海洋青', preview: '#0891b2' },
  { key: 'rose', name: '玫瑰红', preview: '#e11d48' },
  { key: 'dark', name: '深色模式', preview: '#1e293b' },
];

// 点击预设
const onPresetClick = (preset: ThemePreset) => {
  currentPreset.value = preset.key;
  applyThemePreset(preset.key, false);

  // 可选：更新主题配置
  // getThemeConfig.value.primary = preset.colors.primary;
  // setLocalThemeConfig();
};
</script>

<style scoped lang="scss">
.setting-section {
  margin-bottom: var(--spacing-5);

  .section-header {
    margin-bottom: var(--spacing-3);

    .section-title {
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      color: var(--text-primary);
      margin: 0 0 var(--spacing-1) 0;
    }

    .section-desc {
      font-size: var(--text-xs);
      color: var(--text-muted);
      margin: 0;
    }
  }

  .preset-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-2);

    .preset-card {
      padding: var(--spacing-2);
      border: 2px solid var(--border-base);
      border-radius: var(--radius-md);
      cursor: pointer;
      text-align: center;
      transition: all var(--duration-base);

      &:hover {
        border-color: var(--primary-base);
      }

      &.is-active {
        border-color: var(--primary-base);
        background: var(--primary-gradient-subtle);
      }

      .preset-preview {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-sm);
        margin: 0 auto var(--spacing-2);
      }

      .preset-name {
        font-size: var(--text-xs);
        color: var(--text-secondary);
      }
    }
  }
}
</style>
```

---

## 方式三：单独页面配置

### 创建独立主题配置页面

如果需要独立的主题配置页面（适合多租户或系统管理）：

**1. 创建路由**

编辑 `web/src/router/backEnd.ts` 或添加前端路由：

```typescript
{
  path: '/system/theme',
  name: 'systemTheme',
  component: () => import('/@/views/system/theme/index.vue'),
  meta: {
    title: 'message.router.systemTheme',
    isAffix: false,
    isHide: false,
    isKeepAlive: true,
    isLink: '',
    isAuth: true,
    isIframe: false,
    roles: ['admin'],
  },
}
```

**2. 创建页面组件**

创建 `web/src/views/system/theme/index.vue`：

```vue
<template>
  <div class="system-theme-container">
    <el-card>
      <template #header>
        <div class="card-header">
          <h3>主题配置</h3>
          <el-button type="primary" @click="handleSave">保存配置</el-button>
        </div>
      </template>

      <!-- 主题预设选择 -->
      <div class="config-section">
        <h4>主题预设</h4>
        <theme-preset-selector
          v-model="themeConfig.preset"
          @change="handlePresetChange"
        />
      </div>

      <!-- 自定义颜色 -->
      <div class="config-section">
        <h4>自定义颜色</h4>
        <theme-color-picker
          v-model="themeConfig.primaryColor"
          @change="handleColorChange"
        />
      </div>

      <!-- 深色模式 -->
      <div class="config-section">
        <h4>显示模式</h4>
        <el-radio-group v-model="themeConfig.mode" @change="handleModeChange">
          <el-radio-button label="light">浅色</el-radio-button>
          <el-radio-button label="dark">深色</el-radio-button>
          <el-radio-button label="auto">跟随系统</el-radio-button>
        </el-radio-group>
      </div>

      <!-- 预览区域 -->
      <div class="config-section">
        <h4>效果预览</h4>
        <div class="preview-area">
          <div class="preview-header">
            <div class="preview-logo">DVAdmin</div>
            <div class="preview-nav">
              <span class="nav-item">首页</span>
              <span class="nav-item active">系统管理</span>
              <span class="nav-item">用户</span>
            </div>
          </div>
          <div class="preview-body">
            <div class="preview-sidebar">
              <div class="sidebar-item">用户管理</div>
              <div class="sidebar-item active">角色管理</div>
              <div class="sidebar-item">菜单管理</div>
            </div>
            <div class="preview-content">
              <div class="content-card">
                <div class="content-title">数据统计</div>
                <div class="content-body">这里是内容区域</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue';
import { ElMessage } from 'element-plus';
import ThemePresetSelector from '@/components/ThemePresetSelector/index.vue';
import ThemeColorPicker from '@/components/ThemeColorPicker/index.vue';
import { applyThemePreset } from '@/utils/themePresets';

const themeConfig = reactive({
  preset: 'serenity',
  primaryColor: '#2563eb',
  mode: 'light',
});

const handlePresetChange = (preset) => {
  console.log('切换预设:', preset);
};

const handleColorChange = (color) => {
  console.log('颜色变化:', color);
};

const handleModeChange = (mode) => {
  const root = document.documentElement;
  if (mode === 'dark') {
    root.setAttribute('data-theme', 'dark');
  } else {
    root.setAttribute('data-theme', '');
  }
};

const handleSave = () => {
  // 保存配置到后端或 localStorage
  localStorage.setItem('theme-preference', JSON.stringify(themeConfig));
  ElMessage.success('配置已保存');
};

onMounted(() => {
  // 加载保存的配置
  const saved = localStorage.getItem('theme-preference');
  if (saved) {
    Object.assign(themeConfig, JSON.parse(saved));
  }
});
</script>

<style scoped lang="scss">
.system-theme-container {
  padding: var(--spacing-4);

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;

    h3 {
      margin: 0;
      font-size: var(--text-lg);
      font-weight: var(--font-semibold);
    }
  }

  .config-section {
    margin-bottom: var(--spacing-6);

    &:last-child {
      margin-bottom: 0;
    }

    h4 {
      font-size: var(--text-sm);
      font-weight: var(--font-semibold);
      color: var(--text-primary);
      margin: 0 0 var(--spacing-3) 0;
    }
  }

  .preview-area {
    border: 1px solid var(--border-base);
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: var(--bg-page);

    .preview-header {
      display: flex;
      align-items: center;
      padding: var(--spacing-3) var(--spacing-4);
      background: var(--bg-surface);
      border-bottom: 1px solid var(--divider-base);

      .preview-logo {
        font-weight: var(--font-bold);
        margin-right: var(--spacing-6);
      }

      .preview-nav {
        display: flex;
        gap: var(--spacing-4);

        .nav-item {
          font-size: var(--text-sm);
          color: var(--text-secondary);
          cursor: pointer;

          &.active {
            color: var(--primary-base);
            font-weight: var(--font-medium);
          }
        }
      }
    }

    .preview-body {
      display: flex;
      min-height: 200px;

      .preview-sidebar {
        width: 120px;
        background: var(--bg-surface);
        border-right: 1px solid var(--divider-base);
        padding: var(--spacing-3);

        .sidebar-item {
          padding: var(--spacing-2) var(--spacing-3);
          margin-bottom: var(--spacing-1);
          font-size: var(--text-xs);
          color: var(--text-secondary);
          border-radius: var(--radius-sm);
          cursor: pointer;

          &.active {
            background: var(--primary-gradient-subtle);
            color: var(--primary-base);
          }
        }
      }

      .preview-content {
        flex: 1;
        padding: var(--spacing-4);

        .content-card {
          background: var(--bg-surface);
          border: 1px solid var(--border-base);
          border-radius: var(--radius-lg);
          padding: var(--spacing-4);

          .content-title {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            margin-bottom: var(--spacing-3);
          }

          .content-body {
            font-size: var(--text-xs);
            color: var(--text-muted);
          }
        }
      }
    }
  }
}
</style>
```

---

## 方式四：编程式配置

### 在组件中动态切换主题

```vue
<template>
  <div class="my-page">
    <el-button @click="switchTheme('forest')">切换森之绿</el-button>
    <el-button @click="switchTheme('twilight')">切换暮光紫</el-button>
    <el-button @click="toggleDarkMode">{{ isDark ? '浅色' : '深色' }}</el-button>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { applyThemePreset } from '@/utils/themePresets';

const isDark = ref(false);

const switchTheme = (preset: string) => {
  applyThemePreset(preset);
};

const toggleDarkMode = () => {
  isDark.value = !isDark.value;
  const root = document.documentElement;

  if (isDark.value) {
    root.setAttribute('data-theme', 'dark');
  } else {
    root.removeAttribute('data-theme');
  }
};
</script>
```

### 根据用户偏好自动设置

```typescript
import { onMounted } from 'vue';
import { applyThemePreset } from '@/utils/themePresets';

onMounted(() => {
  // 从 localStorage 读取用户偏好
  const savedTheme = localStorage.getItem('user-theme-preference');
  if (savedTheme) {
    applyThemePreset(savedTheme);
  } else {
    // 检测系统深色模式偏好
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (prefersDark) {
      applyThemePreset('dark');
    }
  }
});
```

---

## 配置持久化

### 前端持久化（localStorage）

```typescript
// 保存配置
const saveThemeConfig = (config: any) => {
  localStorage.setItem('theme-config', JSON.stringify(config));
};

// 加载配置
const loadThemeConfig = () => {
  const saved = localStorage.getItem('theme-config');
  return saved ? JSON.parse(saved) : null;
};

// 使用
const config = {
  preset: 'serenity',
  primaryColor: '#2563eb',
  isDark: false,
};

saveThemeConfig(config);
```

### 后端持久化

创建 API 接口保存用户主题偏好：

**1. 创建 API 文件** `web/src/api/user/theme.ts`

```typescript
import request from '/@/utils/request';

/**
 * 获取用户主题配置
 */
export function getUserTheme() {
  return request({
    url: '/api/user/theme/',
    method: 'get',
  });
}

/**
 * 保存用户主题配置
 */
export function saveUserTheme(data: any) {
  return request({
    url: '/api/user/theme/',
    method: 'post',
    data,
  });
}
```

**2. 在组件中使用**

```vue
<script setup lang="ts">
import { onMounted } from 'vue';
import { getUserTheme, saveUserTheme } from '@/api/user/theme';
import { applyThemePreset } from '@/utils/themePresets';

onMounted(async () => {
  try {
    const res = await getUserTheme();
    if (res.data) {
      applyThemePreset(res.data.preset || 'serenity');
    }
  } catch (e) {
    console.error('加载主题配置失败', e);
  }
});

const handleThemeChange = async (preset: string) => {
  applyThemePreset(preset);

  try {
    await saveUserTheme({ preset });
  } catch (e) {
    console.error('保存主题配置失败', e);
  }
};
</script>
```

**3. 后端接口（Django）**

创建 `backend/dvadmin/system/views/theme.py`：

```python
from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated
from dvadmin.utils.viewset import CustomModelViewSet
from dvadmin.system.models import ThemeConfig


@api_view(['GET', 'POST'])
def user_theme(request):
    """
    获取/保存用户主题配置
    """
    if request.method == 'GET':
        # 获取用户主题配置
        config, _ = ThemeConfig.objects.get_or_create(
            user=request.user,
            defaults={'preset': 'serenity', 'is_dark': False}
        )
        return Response({
            'preset': config.preset,
            'is_dark': config.is_dark,
            'primary_color': config.primary_color,
        })

    elif request.method == 'POST':
        # 保存用户主题配置
        config, _ = ThemeConfig.objects.get_or_create(
            user=request.user
        )
        config.preset = request.data.get('preset', 'serenity')
        config.is_dark = request.data.get('is_dark', False)
        config.primary_color = request.data.get('primary_color')
        config.save()
        return Response({'success': True})
```

---

## 常见问题

### Q1: 主题预设切换后样式没有生效？

**A:** 检查以下几点：
1. 确保 `presets.scss` 在 `index.scss` 中最先引入
2. 清除浏览器缓存并强制刷新 (Ctrl+Shift+R)
3. 检查浏览器控制台是否有 CSS 加载错误

### Q2: 如何自定义更多预设主题？

**A:** 在 `utils/themePresets.ts` 中的 `themePresets` 对象添加新预设：

```typescript
const themePresets: Record<string, ThemePreset> = {
  // ... 现有预设

  // 添加新预设
  cherry: {
    name: '樱花粉',
    description: '柔和、浪漫、温馨',
    key: 'cherry',
    colors: {
      primary: '#ff6b9d',
    },
    preview: '#ff6b9d',
  },
};
```

### Q3: 如何禁用某些预设？

**A:** 使用 `filter` 属性：

```vue
<theme-preset-selector
  v-model="currentPreset"
  :filter="(preset) => !preset.isDark"
  @change="handleChange"
/>
```

### Q4: 深色模式如何跟随系统自动切换？

**A:** 监听系统偏好变化：

```typescript
const matchMedia = window.matchMedia('(prefers-color-scheme: dark)');

const handleThemeChange = (e: MediaQueryListEvent) => {
  if (e.matches) {
    applyThemePreset('dark');
  } else {
    // 恢复之前的浅色主题
    applyThemePreset(localStorage.getItem('last-light-theme') || 'serenity');
  }
};

matchMedia.addEventListener('change', handleThemeChange);

// 组件卸载时移除监听
onUnmounted(() => {
  matchMedia.removeEventListener('change', handleThemeChange);
});
```

### Q5: 如何实现多租户主题？

**A:** 根据租户 ID 加载不同主题：

```typescript
import { useUserInfo } from '@/stores/userInfo';
import { applyThemePreset } from '@/utils/themePresets';

const userInfo = useUserInfo();

// 租户主题映射
const tenantThemes: Record<string, string> = {
  'tenant-1': 'serenity',
  'tenant-2': 'sunset',
  'tenant-3': 'forest',
};

onMounted(() => {
  const tenantId = userInfo.userInfos.tenantId;
  const preset = tenantThemes[tenantId] || 'serenity';
  applyThemePreset(preset);
});
```

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `web/src/layout/navBars/breadcrumb/setings.vue` | 原有设置页面 |
| `web/src/layout/navBars/breadcrumb/setings-modern.vue` | 现代化设置页面 |
| `web/src/components/ThemePresetSelector/` | 预设选择器组件 |
| `web/src/components/ThemeColorPicker/` | 颜色选择器组件 |
| `web/src/components/ThemeSettings/` | 完整设置面板组件 |
| `web/src/utils/themePresets.ts` | 主题工具函数 |
| `web/src/theme/presets.scss` | 主题预设 CSS 变量 |
