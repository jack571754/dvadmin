# 图书管理测试数据生成计划

## 任务上下文

**任务描述：** 为 DVAdmin 图书管理模块生成100条技术类图书测试数据

**执行时间：** 2026-01-27

**技术栈：** Django 4.2.14 + Faker

## 解决方案

采用 **Django Management Command** 方案：
- 文件位置：`backend/dvadmin/book/management/commands/generate_book_data.py`
- 命令：`python manage.py generate_book_data`
- 支持参数：`--count`（数量）、`--clean`（清理旧数据）

## 实现细节

### 数据模型关系

```
BookCategory (分类) - 无依赖
BookPublisher (出版社) - 无依赖
BookAuthor (作者) - 无依赖
Book (图书) - 依赖以上三个模型，包含 Many-to-Many 关系
```

### 数据生成策略

**分类（20个）：**
- 编程语言类：Python, Java, JavaScript, Go, Rust, C/C++
- 框架类：Django, Spring Boot, Vue.js, React
- 数据库类：MySQL, PostgreSQL, Redis, MongoDB
- 云原生/DevOps：Docker, Kubernetes, CI/CD
- AI/大数据：机器学习, 深度学习, 大数据

**出版社（17个）：**
- 国内：人民邮电、机械工业、清华大学、电子工业等
- 国外：O'Reilly, Packt, Manning 等

**作者（30+个）：**
- 知名技术专家：廖雪峰、阮一峰、Martin Fowler、Uncle Bob 等
- 随机生成：10个 Faker 生成的作者

**图书（100本）：**
- ISBN：978-7-xxx 或 978-1-xxx 格式（唯一性保证）
- 出版时间：2020-2025
- 价格：39.90-199.00 元
- 页数：200-800 页
- 库存：总数3-20本，可借数量随机比例
- 作者：每本书1-3个作者
- 状态：85%上架，10%下架，3%遗失，2%报废

### 核心功能

1. **清理旧数据（可选）**
   ```python
   if clean:
       Book.objects.all().delete()
       # 级联清理
   ```

2. **数据去重**
   - ISBN 使用 `set()` 保证唯一性
   - 分类、出版社、作者使用 `get_or_create()`

3. **批量创建优化**
   - 使用 `transaction.atomic()` 保证事务一致性
   - Many-to-Many 关系通过 `set()` 处理

4. **可复现随机**
   ```python
   Faker.seed(12345)
   ```

## 使用方法

```bash
# 基础用法：生成100条默认数据
python manage.py generate_book_data

# 指定数量：生成200条数据
python manage.py generate_book_data --count 200

# 清理旧数据后生成
python manage.py generate_book_data --clean

# 组合使用：清理后生成50条
python manage.py generate_book_data --count 50 --clean
```

## 文件清单

| 文件 | 说明 |
|------|------|
| `generate_book_data.py` | Django 管理命令（新建） |
| `requirements.txt` | 添加 Faker>=25.0.0 |
| `models.py` | 数据模型（已存在） |

## 验证步骤

1. 安装 Faker：`pip install Faker`
2. 执行命令：`python manage.py generate_book_data`
3. 检查数据库：
   - Book: 100 条
   - BookCategory: 20 条
   - BookPublisher: 17 条
   - BookAuthor: 30+ 条
4. 通过 Django Admin 验证数据质量

## 注意事项

1. 生成顺序：Category → Publisher → Author → Book
2. ISBN 唯一性：使用 `set()` 去重
3. Many-to-Many：Book.authors 需要在创建后通过 `set()` 添加
4. 外键约束：使用 `on_delete=models.PROTECT` 的模型需注意关联顺序

## 预期结果

- 100本技术类图书，数据真实可信
- 关联关系完整正确
- 支持参数化和重复执行
- 代码符合 Django 最佳实践
