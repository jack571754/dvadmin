# 博客文章添加弹窗布局调整规划

> 创建时间：2026-02-02
> 状态：待执行
> 优先级：中

---

## 一、需求分析

### 1.1 当前问题
- 博客文章添加/编辑弹窗中，文章内容编辑器目前使用固定的 `calc(100vh - 350px)` 高度
- 用户希望文章内容区域占据弹窗的完整下半部分，提供更好的编辑体验

### 1.2 需求目标
- 调整文章表单的布局结构
- 将文章内容编辑器设置为占据弹窗的下半部分（全宽度 + 剩余高度）
- 保持其他字段（标题、摘要、分类、标签等）在上半部分

---

## 二、现状分析

### 2.1 当前代码结构

**文件位置：** `web/src/views/blog/article/crud.tsx`

**当前表单配置：**
- 所有字段都在单列表单中垂直排列
- 文章内容字段使用自定义的 `WngEditor` 组件
- 编辑器高度设置为 `calc(100vh - 350px)`

**问题点：**
- 编辑器高度是基于视口高度计算的，不适合弹窗场景
- 弹窗内容可能需要滚动，编辑器应该自适应弹窗高度

### 2.2 相关文件
- `web/src/views/blog/article/crud.tsx` - 表单配置
- `web/src/views/blog/article/index.vue` - 页面入口
- `web/src/components/editor/index.vue` - 编辑器组件

---

## 三、解决方案设计

### 3.1 布局调整方案

采用 **分栏布局 + 自适应高度** 方案：

```
┌─────────────────────────────────────┐
│  上半部分（固定高度）              │
│  ┌─────────────────────────────┐  │
│  │ 文章标题              │  │  │
│  ├─────────────────────────────┤  │
│  │ 文章摘要              │  │  │
│  ├─────────────────────────────┤  │
│  │ 分类 | 标签 | 状态      │  │  │
│  └─────────────────────────────┘  │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│  下半部分（自适应高度）              │
│  ┌─────────────────────────────┐  │
│  │                            │  │
│  │  文章内容编辑器（全宽）    │  │  │
│  │                            │  │  │
│  │                            │  │  │
│  │  (占据所有剩余空间)        │  │  │
│  │                            │  │  │
│  └─────────────────────────────┘  │
└─────────────────────────────────────┘
```

### 3.2 具体实现步骤

#### 步骤 1: 调整表单布局为分栏结构
- 将表单改为多列布局（columns 模式）
- 上半部分：基础信息字段（title、summary、category、tags、status）
- 下半部分：文章内容（content）

#### 步骤 2: 修改编辑器高度计算
- 移除固定的 `calc(100vh - 350px)` 高度
- 改为使用 `100%` 高度，由父容器控制
- 编辑器自适应弹窗内容区域高度

#### 步骤 3: 配置表单容器
- 使用 `el-row` 和 `el-col` 实现分栏布局
- 设置合适的 gutter 间距
- 上半部分固定高度，下半部分弹性高度

#### 步骤 4: 优化编辑器样式
- 确保编辑器在弹窗内正常显示
- 添加最小高度限制
- 适配弹窗滚动场景

---

## 四、技术实现细节

### 4.1 需要修改的文件

#### 主要文件
- `web/src/views/blog/article/crud.tsx`

#### 依赖文件（可能需要调整）
- `web/src/components/editor/index.vue`

### 4.2 关键代码变更

#### 4.2.1 表单配置调整

**变更前（单列布局）：**
```typescript
form: {
    col: { span: 24 },  // 单列全宽
    // ... 字段配置
}
```

**变更后（分栏布局）：**
```typescript
form: {
    col: { span: 24 },
    wrapper: {
        is: 'el-dialog',
        width: '900px',
    },
    // 使用 columns 模式配置分栏
}
```

#### 4.2.2 字段分组配置

**上半部分字段组：**
```typescript
group: {
    // 使用 el-row 和 el-col 实现布局
    render: (context) => {
        return h('div', { class: 'article-form-top' }, [
            // 第一行：标题（全宽）
            h('el-row', { gutter: 20 }, [
                h('el-col', { span: 24 }, [
                    // 文章标题字段
                ]),
            ]),
            // 第二行：摘要（全宽）
            h('el-row', { gutter: 20 }, [
                h('el-col', { span: 24 }, [
                    // 文章摘要字段
                ]),
            ]),
            // 第三行：分类、标签、状态（分列）
            h('el-row', { gutter: 20 }, [
                h('el-col', { span: 8 }, [
                    // 分类字段
                ]),
                h('el-col', { span: 8 }, [
                    // 标签字段
                ]),
                h('el-col', { span: 8 }, [
                    // 状态字段
                ]),
            ]),
        ]);
    },
}
```

**下半部分字段组：**
```typescript
content: {
    title: '文章内容',
    type: 'text',
    column: { show: false },
    form: {
        rules: [{ required: true, message: '文章内容为必填项' }],
        component: {
            render: (context: any) => {
                return h('div', {
                    class: 'article-content-wrapper',
                    style: { height: 'calc(100vh - 500px)' }
                }, [
                    h(WngEditor, {
                        placeholder: '请输入文章内容...',
                        mode: 'default',
                        height: '100%',
                        getHtml: context.form.content,
                        'onUpdate:getHtml': (value: string) => {
                            context.form.content = value;
                        },
                    }),
                ]);
            },
        },
    },
}
```

### 4.3 样式调整

需要添加自定义样式：

```scss
<style scoped lang="scss">
.article-form-top {
  padding: 20px;
  background: #f5f5f5;
  border-radius: 4px;
  margin-bottom: 20px;
}

.article-content-wrapper {
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  overflow: hidden;
  background: #fff;
}

// 确保编辑器容器占满剩余空间
:deep(.el-dialog__body) {
  padding: 0;
  display: flex;
  flex-direction: column;
}

// 表单容器样式
:deep(.el-form) {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
</style>
```

---

## 五、实施步骤

### 5.1 任务分解

#### 任务 1：分析现有代码结构 ✅
- [x] 阅读 `crud.tsx` 文件
- [x] 理解当前的表单配置
- [x] 查看编辑器组件实现

#### 任务 2：设计新布局结构
- [ ] 确定分栏布局方案
- [ ] 规划上下半部分高度计算方式
- [ ] 设计字段分组策略

#### 任务 3：修改表单配置
- [ ] 调整 content 字段配置
- [ ] 实现上半部分字段分组
- [ ] 配置编辑器高度自适应

#### 任务 4：添加样式支持
- [ ] 添加自定义 CSS 样式
- [ ] 处理弹窗滚动场景
- [ ] 适配不同屏幕尺寸

#### 任务 5：测试验证
- [ ] 测试新增文章功能
- [ ] 测试编辑文章功能
- [ ] 验证弹窗滚动行为
- [ ] 验证编辑器功能正常

### 5.2 风险评估

#### 低风险
- 样式调整仅影响博客文章页面
- 修改仅限于前端组件
- 不涉及后端 API 变更

#### 中风险
- 弹窗高度计算需要仔细测试
- 需要处理不同屏幕尺寸的兼容性

#### 缓解措施
- 保留原有配置作为备份
- 分步骤实施和测试
- 提供回滚方案

---

## 六、验收标准

### 6.1 功能验收
- [ ] 弹窗打开后布局正常，无错位
- [ ] 上半部分字段（标题、摘要等）显示正常
- [ ] 下半部分编辑器占据剩余空间
- [ ] 编辑器高度自适应弹窗大小
- [ ] 弹窗滚动时编辑器固定在下半部分

### 6.2 用户体验验收
- [ ] 编辑器输入体验良好
- [ ] 弹窗整体布局美观协调
- [ ] 移动端显示正常（如果支持）

### 6.3 技术验收
- [ ] 代码符合项目规范
- [ ] 无控制台错误或警告
- [ ] 保持原有功能不受影响

---

## 七、参考文档

- fast-crud 文档：https://fast-crud.doc.fast-crud.cn/
- Element Plus Dialog 文档：https://element-plus.org/zh-CN/component/dialog.html
- WangEditor 文档：https://www.wangeditor.com/

---

## 八、附录

### A. 备份说明
在修改前，建议先备份 `crud.tsx` 文件

### B. 回滚方案
如果新布局出现问题，可以通过以下方式快速回滚：
1. 恢复 `crud.tsx` 的原始配置
2. 移除添加的自定义样式

### C. 后续优化
- 考虑添加全屏编辑模式
- 支持编辑器工具栏自定义配置
- 添加预览功能

---

**文档版本：** v1.0
**创建时间：** 2026-02-02
**预计工时：** 2-3 小时
**负责人：** Claude AI
